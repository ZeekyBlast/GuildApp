"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const discord_akairo_1 = require("discord-akairo");
const discord_js_1 = require("discord.js");
class ban extends discord_akairo_1.Command {
    constructor() {
        super("ban", {
            aliases: ["b"],
            category: "Admin",
            description: {
                content: "Bans a user",
                usage: "ban <user>",
                examples: [
                    "ban @zeekyblast#2158"
                ]
            },
            ratelimit: 5,
            userPermissions: ["ADMINISTRATOR", "BAN_MEMBERS", "MANAGE_GUILD"],
            args: [
                {
                    id: "member",
                    type: "member",
                    prompt: {
                        start: (msg) => `${msg.author}, please provide a member to look at...`,
                        retry: (msg) => `${msg.author}, please provide a valid member to look at...`
                    }
                },
                {
                    id: "reason",
                    type: "string",
                    match: "rest",
                    default: "No reason provided"
                },
                {
                    id: "size",
                    type: (_, str) => {
                        if (str && !isNaN(Number(str)) && [16, 32, 64, 128, 256, 512, 1024, 2048].includes(Number(str)))
                            return Number(str);
                        return null;
                    },
                    match: "option",
                    flag: ["-size="],
                    default: 2048
                }
            ]
        });
    }
    exec(message, { member, reason, size }) {
        const channel = message.member.guild.channels.cache.find(channel => channel.name === "logs");
        if (!message.guild.member(member).bannable)
            return message.channel.send(`${member.user.tag} is not bannable`);
        let nouser = new discord_js_1.MessageEmbed()
            .setColor("RED")
            .setDescription(`${message.author} please mention a user`);
        if (!member)
            return message.channel.send(nouser);
        let send = new discord_js_1.MessageEmbed()
            .setColor("Red")
            .setTitle("Moderation: Ban")
            .addField("Type:", `Perm Ban`)
            .addField("Date:", message.createdAt.toLocaleString())
            .addField("Reason:", `${reason}`);
        let noperms = new discord_js_1.MessageEmbed()
            .setColor("RED")
            .setDescription(`${message.author.tag} you do not have the right perms`);
        if (!message.member.hasPermission("BAN_MEMBERS"))
            return message.channel.send(noperms);
        let confirm = new discord_js_1.MessageEmbed()
            .setColor('YELLOW')
            .setTitle(`Confirm Report`)
            .setDescription(`${message.author} are you shure you want to ban ${member} for ${reason}`);
        let thankyou = new discord_js_1.MessageEmbed()
            .setColor(`GREEN`)
            .setTitle("User Banned")
            .addField("User", member.user.username)
            .addField("Reason", reason)
            .addField("Date", message.createdAt.toLocaleString());
        let botembed = new discord_js_1.MessageEmbed()
            .setColor("RED")
            .setThumbnail(member.user.displayAvatarURL({ size: size }))
            .addField("User:", member.user.username)
            .addField("Tag:", `${member.user.tag}`)
            .addField("NickName:", `${member.nickname}`)
            .addField("JoinedAt:", `${member.joinedAt.toLocaleString()}`)
            .addField("AccountCreated:", `${member.user.createdAt.toLocaleString()}`)
            .addField("Mod:", message.author)
            .addField("Reason:", reason)
            .setAuthor(`${message.guild.name} ModLogs`, message.guild.iconURL())
            .setFooter(`${message.guild.name} ModLogs`, message.guild.iconURL());
        message.channel.send(confirm).then(async (msg) => {
            msg.react('👍');
            msg.react('👎');
            const filter = (reaction, user) => {
                return ['👍', '👎'].includes(reaction.emoji.name) && user.id === message.author.id;
            };
            msg.awaitReactions(filter, { max: 1, time: 60000, errors: ['time'] })
                .then(collected => {
                const reaction = collected.first();
                if (reaction.emoji.name === '👍') {
                    channel.send(botembed);
                    message.author.send(thankyou);
                    message.delete();
                    msg.delete();
                    member.send(send).then(() => message.guild.members.ban(member, { reason: reason }).catch(err => console.log(err)));
                }
                if (reaction.emoji.name === '👎') {
                    message.delete();
                    msg.delete();
                }
            });
        });
    }
}
exports.default = ban;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmFuLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2NvbW1hbmRzL0FkbWluL2Jhbi50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOztBQUFBLG1EQUF5QztBQUN6QywyQ0FBbUQ7QUFVbkQsTUFBcUIsR0FBSSxTQUFRLHdCQUFPO0lBQ3BDO1FBQ0ksS0FBSyxDQUFDLEtBQUssRUFBRTtZQUNULE9BQU8sRUFBRSxDQUFDLEdBQUcsQ0FBQztZQUNkLFFBQVEsRUFBRSxPQUFPO1lBQ2pCLFdBQVcsRUFBRTtnQkFDVCxPQUFPLEVBQUUsYUFBYTtnQkFDdEIsS0FBSyxFQUFFLFlBQVk7Z0JBQ25CLFFBQVEsRUFBRTtvQkFDTixzQkFBc0I7aUJBQ3pCO2FBQ0o7WUFDRCxTQUFTLEVBQUUsQ0FBQztZQUNaLGVBQWUsRUFBRSxDQUFDLGVBQWUsRUFBRSxhQUFhLEVBQUUsY0FBYyxDQUFDO1lBQ2pFLElBQUksRUFBRTtnQkFDRjtvQkFDSSxFQUFFLEVBQUUsUUFBUTtvQkFDWixJQUFJLEVBQUUsUUFBUTtvQkFDZCxNQUFNLEVBQUU7d0JBQ0osS0FBSyxFQUFFLENBQUMsR0FBWSxFQUFFLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUFNLHlDQUF5Qzt3QkFDL0UsS0FBSyxFQUFFLENBQUMsR0FBWSxFQUFFLEVBQUUsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxNQUFNLCtDQUErQztxQkFDeEY7aUJBQ0o7Z0JBQ0Q7b0JBQ0ksRUFBRSxFQUFFLFFBQVE7b0JBQ1osSUFBSSxFQUFFLFFBQVE7b0JBQ2QsS0FBSyxFQUFFLE1BQU07b0JBQ2IsT0FBTyxFQUFFLG9CQUFvQjtpQkFDaEM7Z0JBQ0Q7b0JBQ0ksRUFBRSxFQUFFLE1BQU07b0JBQ1YsSUFBSSxFQUFFLENBQUMsQ0FBVSxFQUFFLEdBQVcsRUFBaUIsRUFBRTt3QkFDN0MsSUFBSSxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDLElBQUksQ0FBQyxF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Q2hCO1lBQ0wsQ0FBQyxDQUFDLENBQUE7UUFDVixDQUFDLENBQUMsQ0FBQTtJQUVOLENBQUM7Q0FDSjtBQTFIRCxzQkEwSEMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21tYW5kIH0gZnJvbSBcImRpc2NvcmQtYWthaXJvXCI7XHJcbmltcG9ydCB7IE1lc3NhZ2UsIE1lc3NhZ2VFbWJlZCB9IGZyb20gXCJkaXNjb3JkLmpzXCI7XHJcbmltcG9ydCB7IENvbGxlY3Rpb24gfSBmcm9tIFwiZGlzY29yZC5qc1wiO1xyXG5pbXBvcnQgeyBUZXh0Q2hhbm5lbCB9IGZyb20gXCJkaXNjb3JkLmpzXCI7XHJcbmltcG9ydCB7IHVybCB9IGZyb20gXCJpbnNwZWN0b3JcIjtcclxuaW1wb3J0IHsgRW1vamkgfSBmcm9tIFwiZGlzY29yZC5qc1wiO1xyXG5pbXBvcnQgeyBSZWFjdGlvbkVtb2ppIH0gZnJvbSBcImRpc2NvcmQuanNcIjtcclxuaW1wb3J0IHsgb3duZXJzIH0gZnJvbSBcIi4uLy4uL0NvbmZpZ1wiO1xyXG5pbXBvcnQgeyBHdWlsZE1lbWJlciB9IGZyb20gXCJkaXNjb3JkLmpzXCI7XHJcbmltcG9ydCB7IEltYWdlU2l6ZSB9IGZyb20gXCJkaXNjb3JkLmpzXCI7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBiYW4gZXh0ZW5kcyBDb21tYW5kIHtcclxuICAgIHB1YmxpYyBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBzdXBlcihcImJhblwiLCB7XHJcbiAgICAgICAgICAgIGFsaWFzZXM6IFtcImJcIl0sXHJcbiAgICAgICAgICAgIGNhdGVnb3J5OiBcIkFkbWluXCIsXHJcbiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiB7XHJcbiAgICAgICAgICAgICAgICBjb250ZW50OiBcIkJhbnMgYSB1c2VyXCIsXHJcbiAgICAgICAgICAgICAgICB1c2FnZTogXCJiYW4gPHVzZXI+XCIsXHJcbiAgICAgICAgICAgICAgICBleGFtcGxlczogW1xyXG4gICAgICAgICAgICAgICAgICAgIFwiYmFuIEB6ZWVreWJsYXN0IzIxNThcIlxyXG4gICAgICAgICAgICAgICAgXVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICByYXRlbGltaXQ6IDUsXHJcbiAgICAgICAgICAgIHVzZXJQZXJtaXNzaW9uczogW1wiQURNSU5JU1RSQVRPUlwiLCBcIkJBTl9NRU1CRVJTXCIsIFwiTUFOQUdFX0dVSUxEXCJdLFxyXG4gICAgICAgICAgICBhcmdzOiBbXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IFwibWVtYmVyXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJtZW1iZXJcIixcclxuICAgICAgICAgICAgICAgICAgICBwcm9tcHQ6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc3RhcnQ6IChtc2c6IE1lc3NhZ2UpID0+IGAke21zZy5hdXRob3J9LCBwbGVhc2UgcHJvdmlkZSBhIG1lbWJlciB0byBsb29rIGF0Li4uYCxcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0cnk6IChtc2c6IE1lc3NhZ2UpID0+IGAke21zZy5hdXRob3J9LCBwbGVhc2UgcHJvdmlkZSBhIHZhbGlkIG1lbWJlciB0byBsb29rIGF0Li4uYFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgaWQ6IFwicmVhc29uXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogXCJzdHJpbmdcIixcclxuICAgICAgICAgICAgICAgICAgICBtYXRjaDogXCJyZXN0XCIsXHJcbiAgICAgICAgICAgICAgICAgICAgZGVmYXVsdDogXCJObyByZWFzb24gcHJvdmlkZWRcIlxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICBpZDogXCJzaXplXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogKF86IE1lc3NhZ2UsIHN0cjogc3RyaW5nKTogbnVsbCB8IE51bWJlciA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdHIgJiYgIWlzTmFOKE51bWJlcihzdHIpKSAmJiBbMTYsIDMyLCA2NCwgMTI4LCAyNTYsIDUxMiwgMTAyNCwgMjA0OF0uaW5jbHVkZXMoTnVtYmVyKHN0cikpKSByZXR1cm4gTnVtYmVyKHN0cik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgbWF0Y2g6IFwib3B0aW9uXCIsXHJcbiAgICAgICAgICAgICAgICAgICAgZmxhZzogW1wiLXNpemU9XCJdLFxyXG4gICAgICAgICAgICAgICAgICAgIGRlZmF1bHQ6IDIwNDhcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXVxyXG4gICAgICAgIH0pXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGV4ZWMobWVzc2FnZTogTWVzc2FnZSwgeyBtZW1iZXIsIHJlYXNvbiwgc2l6ZSB9OiB7IG1lbWJlcjogR3VpbGRNZW1iZXIsIHJlYXNvbjogc3RyaW5nLCBzaXplOiBudW1iZXIgfSk6IFByb21pc2U8TWVzc2FnZT4ge1xyXG5cclxuICAgICAgICBjb25zdCBjaGFubmVsID0gbWVzc2FnZS5tZW1iZXIuZ3VpbGQuY2hhbm5lbHMuY2FjaGUuZmluZChjaGFubmVsID0+IGNoYW5uZWwubmFtZSA9PT0gXCJsb2dzXCIpO1xyXG5cclxuICAgICAgICBpZiAoIW1lc3NhZ2UuZ3VpbGQubWVtYmVyKG1lbWJlcikuYmFubmFibGUpIHJldHVybiBtZXNzYWdlLmNoYW5uZWwuc2VuZChgJHttZW1iZXIudXNlci50YWd9IGlzIG5vdCBiYW5uYWJsZWApO1xyXG5cclxuICAgICAgICBsZXQgbm91c2VyID0gbmV3IE1lc3NhZ2VFbWJlZCgpXHJcbiAgICAgICAgICAgIC5zZXRDb2xvcihcIlJFRFwiKVxyXG4gICAgICAgICAgICAuc2V0RGVzY3JpcHRpb24oYCR7bWVzc2FnZS5hdXRob3J9IHBsZWFzZSBtZW50aW9uIGEgdXNlcmApO1xyXG5cclxuICAgICAgICBpZiAoIW1lbWJlcikgcmV0dXJuIG1lc3NhZ2UuY2hhbm5lbC5zZW5kKG5vdXNlcik7XHJcblxyXG4gICAgICAgIGxldCBzZW5kID0gbmV3IE1lc3NhZ2VFbWJlZCgpXHJcbiAgICAgICAgICAgIC5zZXRDb2xvcihcIlJlZFwiKVxyXG4gICAgICAgICAgICAuc2V0VGl0bGUoXCJNb2RlcmF0aW9uOiBCYW5cIilcclxuICAgICAgICAgICAgLmFkZEZpZWxkKFwiVHlwZTpcIiwgYFBlcm0gQmFuYClcclxuICAgICAgICAgICAgLmFkZEZpZWxkKFwiRGF0ZTpcIiwgbWVzc2FnZS5jcmVhdGVkQXQudG9Mb2NhbGVTdHJpbmcoKSlcclxuICAgICAgICAgICAgLmFkZEZpZWxkKFwiUmVhc29uOlwiLCBgJHtyZWFzb259YCk7XHJcblxyXG4gICAgICAgIGxldCBub3Blcm1zID0gbmV3IE1lc3NhZ2VFbWJlZCgpXHJcbiAgICAgICAgICAgIC5zZXRDb2xvcihcIlJFRFwiKVxyXG4gICAgICAgICAgICAuc2V0RGVzY3JpcHRpb24oYCR7bWVzc2FnZS5hdXRob3IudGFnfSB5b3UgZG8gbm90IGhhdmUgdGhlIHJpZ2h0IHBlcm1zYCk7XHJcblxyXG4gICAgICAgIGlmICghbWVzc2FnZS5tZW1iZXIuaGFzUGVybWlzc2lvbihcIkJBTl9NRU1CRVJTXCIpKSByZXR1cm4gbWVzc2FnZS5jaGFubmVsLnNlbmQobm9wZXJtcyk7XHJcblxyXG4gICAgICAgIGxldCBjb25maXJtID0gbmV3IE1lc3NhZ2VFbWJlZCgpXHJcbiAgICAgICAgICAgIC5zZXRDb2xvcignWUVMTE9XJylcclxuICAgICAgICAgICAgLnNldFRpdGxlKGBDb25maXJtIFJlcG9ydGApXHJcbiAgICAgICAgICAgIC5zZXREZXNjcmlwdGlvbihgJHttZXNzYWdlLmF1dGhvcn0gYXJlIHlvdSBzaHVyZSB5b3Ugd2FudCB0byBiYW4gJHttZW1iZXJ9IGZvciAke3JlYXNvbn1gKTtcclxuXHJcbiAgICAgICAgbGV0IHRoYW5reW91ID0gbmV3IE1lc3NhZ2VFbWJlZCgpXHJcbiAgICAgICAgICAgIC5zZXRDb2xvcihgR1JFRU5gKVxyXG4gICAgICAgICAgICAuc2V0VGl0bGUoXCJVc2VyIEJhbm5lZFwiKVxyXG4gICAgICAgICAgICAuYWRkRmllbGQoXCJVc2VyXCIsIG1lbWJlci51c2VyLnVzZXJuYW1lKVxyXG4gICAgICAgICAgICAuYWRkRmllbGQoXCJSZWFzb25cIiwgcmVhc29uKVxyXG4gICAgICAgICAgICAuYWRkRmllbGQoXCJEYXRlXCIsIG1lc3NhZ2UuY3JlYXRlZEF0LnRvTG9jYWxlU3RyaW5nKCkpXHJcblxyXG4gICAgICAgIGxldCBib3RlbWJlZCA9IG5ldyBNZXNzYWdlRW1iZWQoKVxyXG4gICAgICAgICAgICAuc2V0Q29sb3IoXCJSRURcIilcclxuICAgICAgICAgICAgLnNldFRodW1ibmFpbChtZW1iZXIudXNlci5kaXNwbGF5QXZhdGFyVVJMKHsgc2l6ZTogc2l6ZSBhcyBJbWFnZVNpemUgfSkpXHJcbiAgICAgICAgICAgIC5hZGRGaWVsZChcIlVzZXI6XCIsIG1lbWJlci51c2VyLnVzZXJuYW1lKVxyXG4gICAgICAgICAgICAuYWRkRmllbGQoXCJUYWc6XCIsIGAke21lbWJlci51c2VyLnRhZ31gKVxyXG4gICAgICAgICAgICAuYWRkRmllbGQoXCJOaWNrTmFtZTpcIiwgYCR7bWVtYmVyLm5pY2tuYW1lfWApXHJcbiAgICAgICAgICAgIC5hZGRGaWVsZChcIkpvaW5lZEF0OlwiLCBgJHttZW1iZXIuam9pbmVkQXQudG9Mb2NhbGVTdHJpbmcoKX1gKVxyXG4gICAgICAgICAgICAuYWRkRmllbGQoXCJBY2NvdW50Q3JlYXRlZDpcIiwgYCR7bWVtYmVyLnVzZXIuY3JlYXRlZEF0LnRvTG9jYWxlU3RyaW5nKCl9YClcclxuICAgICAgICAgICAgLmFkZEZpZWxkKFwiTW9kOlwiLCBtZXNzYWdlLmF1dGhvcilcclxuICAgICAgICAgICAgLmFkZEZpZWxkKFwiUmVhc29uOlwiLCByZWFzb24pXHJcbiAgICAgICAgICAgIC5zZXRBdXRob3IoYCR7bWVzc2FnZS5ndWlsZC5uYW1lfSBNb2RMb2dzYCwgbWVzc2FnZS5ndWlsZC5pY29uVVJMKCkpXHJcbiAgICAgICAgICAgIC5zZXRGb290ZXIoYCR7bWVzc2FnZS5ndWlsZC5uYW1lfSBNb2RMb2dzYCwgbWVzc2FnZS5ndWlsZC5pY29uVVJMKCkpXHJcblxyXG4gICAgICAgIG1lc3NhZ2UuY2hhbm5lbC5zZW5kKGNvbmZpcm0pLnRoZW4oYXN5bmMgbXNnID0+IHtcclxuICAgICAgICAgICAgbXNnLnJlYWN0KCfwn5GNJylcclxuICAgICAgICAgICAgbXNnLnJlYWN0KCfwn5GOJylcclxuXHJcblxyXG4gICAgICAgICAgICBjb25zdCBmaWx0ZXIgPSAocmVhY3Rpb24sIHVzZXIpID0+IHtcclxuICAgICAgICAgICAgICAgIHJldHVybiBbJ/CfkY0nLCAn8J+RjiddLmluY2x1ZGVzKHJlYWN0aW9uLmVtb2ppLm5hbWUpICYmIHVzZXIuaWQgPT09IG1lc3NhZ2UuYXV0aG9yLmlkO1xyXG4gICAgICAgICAgICB9O1xyXG5cclxuICAgICAgICAgICAgbXNnLmF3YWl0UmVhY3Rpb25zKGZpbHRlciwgeyBtYXg6IDEsIHRpbWU6IDYwMDAwLCBlcnJvcnM6IFsndGltZSddIH0pXHJcbiAgICAgICAgICAgICAgICAudGhlbihjb2xsZWN0ZWQgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlYWN0aW9uID0gY29sbGVjdGVkLmZpcnN0KCk7XHJcblxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWFjdGlvbi5lbW9qaS5uYW1lID09PSAn8J+RjScpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgKGNoYW5uZWwgYXMgVGV4dENoYW5uZWwpLnNlbmQoYm90ZW1iZWQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmF1dGhvci5zZW5kKHRoYW5reW91KVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLmRlbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtc2cuZGVsZXRlKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1lbWJlci5zZW5kKHNlbmQpLnRoZW4oKCkgPT5cclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UuZ3VpbGQubWVtYmVycy5iYW4obWVtYmVyLCB7IHJlYXNvbjogcmVhc29uIH0pLmNhdGNoKGVyciA9PiBjb25zb2xlLmxvZyhlcnIpKSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmIChyZWFjdGlvbi5lbW9qaS5uYW1lID09PSAn8J+RjicpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5kZWxldGUoKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbXNnLmRlbGV0ZSgpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfSlcclxuXHJcbiAgICB9XHJcbn0iXX0=